# 开发新模型踩坑流程(det)

参考开发yolox的过程，对于维护和开发mtl，进行启发和记录
1.移植head、neck和backbone代码，在init注册好模块，除了自身的代码，其他的接口代码可以参考接口文档，进行定义实现，也可以先从同一类是实现的代码中复制再修改
2.参考其他model的代码，调试yolox.py代码，修改simple_test和forward_train代码
3.第一目标先调通推理代码的逻辑，配置好task的各个模块，可以参考其他task任务，然后修改backbone、neck和head的名字和配置
4.通过tools/model_export/model_show.py对比标准的yolox项目生成的模型和mtl生成的模型，对比生成的层数和维度值，如果有所不同，进行调试，修改，测试
5.将标准的yolox的模型使用推理代码进行测试，先测试模型是否通，模型可以推理，就是王络基本没问题，再测试模型输出是否一致，如果结果数据不一致，第一看配置，第二看预处理，第三看输入输出格式
6.推理代码调通后，进行训练代码的调试，主要是yolox.py中forward_train，ylox_head.py中的forward_train等代码进行调试
7.在调整训练代码中，loss代码需要重视，先移植对应的loss代码，跟backbone等注册机制一样，在init中定义好。调试成功后再考虑是否loss函数可以合并，配准输入，在head中定义好注册的loss，多个loss对应匹配好。在mtl中，gt_labels和gt_bboxes是分开定义的，对所有输入的值需要对应上源码yolox的输入，并且yolox的bboxes是xywh格式，mtl输入的bboxes格式是xyxy，这些问题都需要匹配好，不然训练就会失败。
8.loss配置好后，理论上可以正常训练了，如果结果有问题，偏差大的话，一个先对比数据输入是否和源代码是否一致，再对比计算loss的结果是否有偏差，需要仔细微调，结果对比可以选用通用数据集进行检测比对。